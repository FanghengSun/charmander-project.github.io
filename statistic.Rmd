---
title: "Weather Observations"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(rsconnect)
```

```{r}
fire_df = read_csv("./data/forestfires.csv")
descrip_1 = 
  fire_df %>% 
  select(-day, -area,) %>% 
  group_by(X, Y, month) %>% 
  mutate(
    avg_FFMC = mean(FFMC),
    avg_DMC = mean(DMC),
    avg_DC = mean(DC),
    avg_ISI = mean(ISI),
    avg_temp = mean(temp),
    avg_RH = mean(RH),
    avg_wind = mean(wind),
    tot_rain = sum(rain)
    ) %>% 
  select(-FFMC, -DMC, -DC, -ISI, -temp, -RH, -wind, -rain) %>% 
  distinct() %>% 
  ungroup()

descrip_2 = 
  expand.grid(
    month = unique(pull(descrip_1, month)),
    X = unique(pull(descrip_1, X)),
    Y = unique(pull(descrip_1, Y))
  ) %>% 
  mutate(
    month = factor(month, 
                   levels = c('jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'),
                   ordered = TRUE
                   )
    )

descrip_3 = 
  merge(
    descrip_2, descrip_1, all = TRUE
  ) %>% 
  arrange(X, Y, month)

descrip_3[is.na(descrip_3)] <- 0

descrip_4 = 
  descrip_3  %>% 
  pivot_longer(avg_FFMC:tot_rain,
               names_to = "FWI",
               values_to = "value") %>% 
  mutate(
    FWI = replace(FWI, FWI == "avg_FFMC", "Mean FFMC"),
    FWI = replace(FWI, FWI == "avg_DMC", "Mean DMC"),
    FWI = replace(FWI, FWI == "avg_DC", "Mean DC"),
    FWI = replace(FWI, FWI == "avg_ISI", "Mean ISI"),
    FWI = replace(FWI, FWI == "avg_temp", "Mean Temperature"),
    FWI = replace(FWI, FWI == "avg_RH", "Mean Relative Humidity"),
    FWI = replace(FWI, FWI == "avg_wind", "Mean Wind Speed"),
    FWI = replace(FWI, FWI == "tot_rain", "Total Precipitation"),
  )
```


Column {.sidebar}
-----------------------------------------------------------------------

```{r}
x_choices = descrip_3 %>% pull(X) %>% unique()

radioButtons(
  "x_choice",
  h3("X-axis Coordinate"),
  choices = x_choices,
  selected = "6"
)

y_choices = descrip_3 %>% pull(Y) %>% unique()

radioButtons(
  "y_choice",
  h3("Y-axis Coordinate"),
  choices = y_choices,
  selected = "5"
)

FWI_choices = descrip_4 %>% pull(FWI) %>% unique()

selectInput(
  "FWI_choice",
  h3("FWI Variables"),
  choices = FWI_choices,
  selected = "Mean DC"
)
```


Column {}
-----------------------------------------------------------------------


```{r}
renderPlotly({
descrip_4 %>% 
  filter(
      X == input[["x_choice"]],
      Y == input[["y_choice"]],
      FWI == input[["FWI_choice"]]
  ) %>% 
  plot_ly(
    y = ~value, x = ~month, color = ~month,
    type = "bar", colors = "viridis")
})
```
